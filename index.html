
<!DOCTYPE html>

<html lang="fr">
<head>
<meta charset="utf-8"/>
<title>Inscription - Tennis Club de Pimprez</title>
</head>
<body>
<h1>Inscription - Saison 2025-2026</h1>
<div id="confirmation-message" style="display:none;">
<h3>Merci !</h3>
<button id="btn-new-inscription">Nouvelle inscription</button>
</div>
<form id="inscriptionForm">
<div id="membres-wrapper">
<div class="membre-bloc">
<label>Prénom <input name="prenom[1]" required=""/></label><br/>
<label>Nom <input name="nom[1]" required=""/></label><br/>
<label>Date de naissance <input name="date_naissance[1]" type="date"/></label><br/>
<label>Adresse <input name="adresse[1]"/></label><br/>
<label>Code Postal <input name="code_postal[1]"/></label><br/>
<label>Ville <input name="ville[1]"/></label><br/>
<label>Email <input name="email[1]" type="email"/></label><br/>
<label>Téléphone <input name="tel_mobile[1]" type="tel"/></label><br/>
</div>
</div>
<button id="btn-ajouter-membre" type="button">Ajouter un membre</button>
<button type="submit">Envoyer</button>
</form>

<script>
// ✨ Nouvelle version : formulaire multi-membres dynamiques dans une seule soumission

const confirmationMessage = document.getElementById("confirmation-message");
confirmationMessage.style.display = "none";

const form = document.getElementById("inscriptionForm");
const membreContainer = document.getElementById("membres-wrapper");
let membreIndex = 1;

// Champs partagés à recopier
const champsFamille = ["adresse", "code_postal", "ville", "email", "tel_mobile", "tel_fixe"];

// Crée une nouvelle section de membre
function ajouterMembre(preRemplir = true) {
    const original = document.querySelector(".membre-bloc");
    const clone = original.cloneNode(true);

    membreIndex++;
    clone.querySelectorAll("input, select").forEach(input => {
        input.name = input.name.replace(/\[\d+\]/, `[${membreIndex}]`);
        input.value = "";
        input.required = false;
        if (preRemplir && champsFamille.includes(input.name.split("[")[0])) {
            const refInput = original.querySelector(`[name='${input.name.split("[")[0]}[1]']`);
            if (refInput) input.value = refInput.value;
        }
    });

    membreContainer.appendChild(clone);
}

// Gère l'envoi groupé via Basin
form.addEventListener("submit", function(e) {
    e.preventDefault();

    const formData = new FormData(form);

    fetch("https://usebasin.com/f/28ad0c57c7ea", {
        method: "POST",
        body: formData,
    })
    .then(response => {
        if (response.ok) {
            form.style.display = "none";
            confirmationMessage.style.display = "block";
        } else {
            alert("Erreur lors de l'envoi du formulaire. Veuillez réessayer.");
        }
    })
    .catch(error => {
        console.error("Erreur réseau:", error);
        alert("Une erreur s'est produite. Veuillez réessayer plus tard.");
    });
});

// Ajoute le 1er bouton pour nouveau membre
const btnAjout = document.getElementById("btn-ajouter-membre");
btnAjout.addEventListener("click", () => ajouterMembre());

// Nouveau bouton après envoi
const btnNewInscription = document.getElementById("btn-new-inscription");
btnNewInscription.addEventListener("click", () => {
    confirmationMessage.style.display = "none";
    form.style.display = "block";
    form.reset();
    // supprimer membres supplémentaires
    membreContainer.querySelectorAll(".membre-bloc").forEach((el, i) => { if (i > 0) el.remove(); });
});
</script>
</body>
</html>
