<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Administration - Tennis Club de Pimprez</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        :root {
            --header-color: #4CAF50;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f5f5f5;
        }
        
        .header {
            background-color: var(--header-color);
            color: white;
            padding: 20px 0;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.2rem;
            margin: 0;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: white;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }
        
        .section-title {
            color: var(--header-color);
            border-left: 4px solid var(--header-color);
            padding-left: 10px;
            margin-top: 30px;
            margin-bottom: 20px;
        }
        
        .field-item {
            margin-bottom: 20px;
            padding: 15px;
            border-radius: 5px;
            background-color: #f9f9f9;
        }
        
        .form-check-label {
            font-weight: 500;
        }
        
        .color-picker {
            width: 100%;
            height: 40px;
            padding: 5px;
            border: 1px solid #ced4da;
            border-radius: 4px;
        }
        
        .btn-save {
            background-color: var(--header-color);
            color: white;
            padding: 10px 30px;
            font-size: 1.1rem;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .btn-save:hover {
            background-color: #3d8b40;
        }
        
        .footer {
            text-align: center;
            padding: 20px 0;
            color: #666;
            font-size: 0.9rem;
        }
        
        /* Style pour la fenêtre modale de connexion */
        .login-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .login-content {
            background-color: white;
            padding: 30px;
            border-radius: 5px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
        
        .login-title {
            color: var(--header-color);
            margin-bottom: 20px;
            text-align: center;
        }
        
        .login-btn {
            background-color: var(--header-color);
            color: white;
            width: 100%;
            padding: 10px;
            border: none;
            border-radius: 5px;
            margin-top: 20px;
            cursor: pointer;
        }
        
        .login-btn:hover {
            background-color: #3d8b40;
        }
        
        /* Style pour le lien de partage */
        .share-link-container {
            margin-top: 20px;
            padding: 15px;
            background-color: #f0f8ff;
            border-radius: 5px;
            border: 1px solid #b8daff;
        }
        
        .share-link-input {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #ced4da;
            border-radius: 4px;
        }
        
        .copy-btn {
            background-color: #007bff;
            color: white;
            padding: 8px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .copy-btn:hover {
            background-color: #0069d9;
        }
    </style>
</head>
<body>
    <div class="header">
        <img src="images/logo.jpg" alt="Tennis Club de Pimprez" width="100" height="100">
        <h1>Administration - Tennis Club de Pimprez</h1>
        <p>Personnalisation du formulaire d'inscription</p>
    </div>
    
    <div class="container">
        <div class="alert alert-info">
            Activez ou désactivez les champs du formulaire en cochant les cases correspondantes. Cliquez sur "Enregistrer" pour appliquer vos modifications.
        </div>
        
        <div id="admin-panel" style="display: none;">
            <h3 class="section-title">Informations personnelles</h3>
            <div class="row">
                <div class="col-md-6">
                    <div class="field-item">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="field_civilite" checked>
                            <label class="form-check-label" for="field_civilite">
                                Civilité (M./Mme/Autre)
                            </label>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="field-item">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="field_date_naissance" checked>
                            <label class="form-check-label" for="field_date_naissance">
                                Date de naissance
                            </label>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6">
                    <div class="field-item">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="field_nom" checked>
                            <label class="form-check-label" for="field_nom">
                                Nom
                            </label>
                        </div>
                        <p class="text-muted small">Ce champ est obligatoire et ne peut pas être désactivé</p>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="field-item">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="field_prenom" checked>
                            <label class="form-check-label" for="field_prenom">
                                Prénom
                            </label>
                        </div>
                        <p class="text-muted small">Ce champ est obligatoire et ne peut pas être désactivé</p>
                    </div>
                </div>
            </div>
            
            <h3 class="section-title">Informations sportives</h3>
            <div class="row">
                <div class="col-md-6">
                    <div class="field-item">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="field_competitions" checked>
                            <label class="form-check-label" for="field_competitions">
                                Participation aux compétitions
                            </label>
                        </div>
                    </div>
                </div>
            </div>
            
            <h3 class="section-title">Coordonnées</h3>
            <div class="row">
                <div class="col-md-6">
                    <div class="field-item">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="field_adresse" checked>
                            <label class="form-check-label" for="field_adresse">
                                Adresse
                            </label>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="field-item">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="field_ville" checked>
                            <label class="form-check-label" for="field_ville">
                                Ville
                            </label>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6">
                    <div class="field-item">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="field_code_postal" checked>
                            <label class="form-check-label" for="field_code_postal">
                                Code postal
                            </label>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="field-item">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="field_tel_mobile" checked>
                            <label class="form-check-label" for="field_tel_mobile">
                                Téléphone mobile
                            </label>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6">
                    <div class="field-item">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="field_tel_fixe">
                            <label class="form-check-label" for="field_tel_fixe">
                                Téléphone fixe
                            </label>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="field-item">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="field_email" checked>
                            <label class="form-check-label" for="field_email">
                                Email
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <h3 class="section-title">Personnalisation</h3>
            <div class="row mb-3">
                <div class="col-md-6">
                    <label for="club_name" class="form-label">Nom du club</label>
                    <input type="text" class="form-control" id="club_name" value="Tennis Club de Pimprez">
                </div>
                <div class="col-md-6">
                    <label for="season" class="form-label">Saison</label>
                    <input type="text" class="form-control" id="season" value="2025-2026">
                </div>
            </div>
            <div class="row mb-3">
                <div class="col-md-6">
                    <label for="header_color" class="form-label">Couleur de l'en-tête</label>
                    <input type="color" class="color-picker" id="header_color" value="#4CAF50">
                </div>
                <div class="col-md-6">
                    <label for="button_color" class="form-label">Couleur des boutons</label>
                    <input type="color" class="color-picker" id="button_color" value="#4CAF50">
                </div>
            </div>

            <div class="row mt-4">
                <div class="col-md-12 text-center">
                    <button type="button" id="btn-save" class="btn btn-save">Enregistrer les modifications</button>
                </div>
            </div>
            
            <div class="share-link-container mt-4">
                <h4>Lien de partage avec configuration</h4>
                <p>Copiez ce lien pour partager le formulaire avec exactement la même configuration :</p>
                <input type="text" id="share-link" class="share-link-input" readonly>
                <button id="copy-link-btn" class="copy-btn">Copier le lien</button>
            </div>
        </div>
        
        <div id="login-form" class="login-modal">
            <div class="login-content">
                <h3 class="login-title">Accès Administration</h3>
                <p>Veuillez entrer le mot de passe pour accéder au panneau d'administration.</p>
                <div class="mb-3">
                    <label for="password" class="form-label">Mot de passe:</label>
                    <input type="password" class="form-control" id="password">
                </div>
                <button type="button" id="login-btn" class="login-btn">Se connecter</button>
                <div class="text-center mt-3">
                    <a href="index.html">Retour au formulaire</a>
                </div>
            </div>
        </div>
    </div>
    
    <div class="footer">
        <div class="container">
            <p>Tennis Club de Pimprez - Tous droits réservés</p>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="admin_secure.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Vérifier si des paramètres de configuration sont présents dans l'URL
            const urlParams = new URLSearchParams(window.location.search);
            let configFromUrl = null;
            
            if (urlParams.has('config')) {
                try {
                    // Décoder et parser la configuration depuis l'URL
                    const encodedConfig = urlParams.get('config');
                    const jsonConfig = atob(encodedConfig);
                    configFromUrl = JSON.parse(jsonConfig);
                    
                    // Sauvegarder cette configuration dans le localStorage
                    localStorage.setItem('formConfig', JSON.stringify(configFromUrl));
                    
                    // Rediriger vers la page sans paramètres pour nettoyer l'URL
                    window.history.replaceState({}, document.title, 'admin.html');
                } catch (e) {
                    console.error("Erreur lors du décodage de la configuration:", e);
                }
            }
            
            // Charger la configuration depuis le localStorage si elle existe
            const savedConfig = localStorage.getItem('formConfig');
            if (savedConfig) {
                try {
                    const parsedConfig = JSON.parse(savedConfig);
                    // Appliquer la configuration chargée si elle est valide
                    if (parsedConfig && typeof parsedConfig === 'object') {
                        applyAdminConfig(parsedConfig);
                    }
                } catch (e) {
                    console.error("Erreur lors du parsing de la configuration sauvegardée:", e);
                    // Supprimer la configuration invalide pour éviter des erreurs futures
                    localStorage.removeItem('formConfig');
                }
            }

            // Fonction pour appliquer la configuration à l'interface d'administration
            function applyAdminConfig(cfg) {
                // Appliquer les couleurs
                document.documentElement.style.setProperty('--header-color', cfg.headerColor);
                document.getElementById('header_color').value = cfg.headerColor;
                document.getElementById('button_color').value = cfg.buttonColor;

                // Mettre à jour le nom du club et la saison
                document.getElementById('club_name').value = cfg.clubName;
                document.getElementById('season').value = cfg.season;

                // Mettre à jour l'état des checkboxes pour les champs
                for (const [field, visible] of Object.entries(cfg.fields)) {
                    const checkbox = document.getElementById(`field_${field}`);
                    if (checkbox) {
                        checkbox.checked = visible;
                    }
                }

                // Mettre à jour l'état des checkboxes et les textes pour les infos admin
                if (cfg.admin) {
                    const certMedicalCheckbox = document.getElementById('field_certificat_medical');
                    if (certMedicalCheckbox) {
                        certMedicalCheckbox.checked = cfg.admin.certificat_medical;
                        document.getElementById('text_certificat_medical').value = cfg.admin.text_certificat_medical;
                    }
                    const reglementCheckbox = document.getElementById('field_reglement');
                    if (reglementCheckbox) {
                        reglementCheckbox.checked = cfg.admin.reglement;
                        document.getElementById('text_reglement').value = cfg.admin.text_reglement;
                    }
                }
            }

            // Gérer le bouton d'enregistrement
            document.getElementById('btn-save').addEventListener('click', function() {
                const newConfig = {
                    fields: {},
                    admin: {},
                    clubName: document.getElementById('club_name').value,
                    season: document.getElementById('season').value,
                    headerColor: document.getElementById('header_color').value,
                    buttonColor: document.getElementById('button_color').value
                };

                // Récupérer l'état des checkboxes pour les champs
                for (const [field, value] of Object.entries(config.fields)) {
                    const checkbox = document.getElementById(`field_${field}`);
                    if (checkbox) {
                        newConfig.fields[field] = checkbox.checked;
                    }
                }

                // Récupérer l'état des checkboxes et les textes pour les infos admin
                const certMedicalCheckbox = document.getElementById('field_certificat_medical');
                if (certMedicalCheckbox) {
                    newConfig.admin.certificat_medical = certMedicalCheckbox.checked;
                    newConfig.admin.text_certificat_medical = document.getElementById('text_certificat_medical').value;
                }
                const reglementCheckbox = document.getElementById('field_reglement');
                if (reglementCheckbox) {
                    newConfig.admin.reglement = reglementCheckbox.checked;
                    newConfig.admin.text_reglement = document.getElementById('text_reglement').value;
                }

                // Sauvegarder la nouvelle configuration dans le localStorage
                localStorage.setItem('formConfig', JSON.stringify(newConfig));
                alert('Modifications enregistrées !');

                // Mettre à jour le lien de partage
                updateShareLink(newConfig);
            });

            // Fonction pour mettre à jour le lien de partage
            function updateShareLink(cfg) {
                const shareLinkInput = document.getElementById('share-link');
                const currentUrl = window.location.origin + window.location.pathname;
                const encodedConfig = btoa(JSON.stringify(cfg));
                shareLinkInput.value = `${currentUrl}?config=${encodedConfig}`;
            }

            // Gérer le bouton de copie du lien
            document.getElementById('copy-link-btn').addEventListener('click', function() {
                const shareLinkInput = document.getElementById('share-link');
                shareLinkInput.select();
                document.execCommand('copy');
                alert('Lien copié dans le presse-papiers !');
            });

            // Initialiser le lien de partage avec la configuration actuelle
            updateShareLink(config);
        });
    </script>
</body>
</html>

